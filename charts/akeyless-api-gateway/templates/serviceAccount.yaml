{{ $global := . }}
{{ with .Values.deployment.service_account }}
{{- if and (.enabled) (not .use_existing) }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ .serviceAccountName }}
  namespace: {{ $global.Release.Namespace | quote }}
  {{- if .annotations }}
  annotations:
    {{ toYaml .annotations | indent 2 }}
  {{- end -}}
{{- end -}}
{{- end -}}