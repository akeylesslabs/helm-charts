{{- if (eq "true" (include "akeyless-gateway.clusterCache.autogeneratedTls" . )) }}
{{- $tlsSecretName := (include "akeyless-gateway.clusterCache.generatedCacheTlsSecretName" .)}}
{{- $fullname := .Release.Name | trunc 63 | trimSuffix "-" -}}
{{- $ca := genCA "redis-ca" 365 }}
{{- $altNames := list (include "akeyless-gateway.clusterCache.cacheAddress" .) (printf "*.%s" (include "akeyless-gateway.clusterCache.cacheAddress" . )) "127.0.0.1" "localhost" $fullname }}
{{- $cert := genSignedCert $fullname nil $altNames 365 $ca }}
{{- $existingSecret := (lookup "v1" "Secret" .Release.Namespace $tlsSecretName).data }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $tlsSecretName }}
  namespace: {{ .Release.Namespace | quote }}
  labels:
    name: {{ $tlsSecretName }}
    component: cache
{{- include "akeyless-gateway.labels" . | nindent 4 }}
type: kubernetes.io/tls
data:
  tls.crt: {{ get $existingSecret "tls.crt" | default ($cert.Cert | b64enc) }}
  tls.key: {{ get $existingSecret "tls.key" | default ($cert.Key | b64enc) }}
  ca.crt: {{ get $existingSecret "ca.crt" | default ($ca.Cert | b64enc) }}
{{- end }}